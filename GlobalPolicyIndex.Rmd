---
title: "Global policy index"
author: "Jonas Rekdal Mathisen"
date: "20/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

This analyses utilises the NOURISHING policy database from <http://policydatabase.wcrf.org>. 

The aim is to produce an overview of implemented policies globally within the NOURISHING frameworks pillars:

![Alt text](C:\Users\JRMA\OneDrive - Folkehelseinstituttet\Dokumenter\CO-CREATE\graphs\PPA-Nourishing-WEB.jpg.webp)

This index provides a simple overview of implemented policies. This simplified index can tell you to what extent a policy dimension is implemented and ongoing in a country only. It does not indicate how broad the policy is, how well it works or how long it has been implemented. 

REF FOR SELF:
Global policy scan i R:

Lag unike vektorer:
	1. Land
	2. Policy group (x3 overkategorier)
	3. Policy dimension (x10)
	4. Sub-policy (x mange)

Sjekke hvilke land har hvilke policyer på sub-policy nivå:
	• IF-funksjon som sjekker om landet har en policy i det spesifikke område. 
	• Loopen må gå gjennom alle sub-policy områdene for hvert land. 
	• Tilbake vil jeg ha antall policyer som kolonne 1, og en TRUE/FALSE statement i kolonne to om policy>0.

Aggregering [Kan sikkert gjøres i COINr]
	• I hver sub-policy area må TRUE adderes (T+F+T+T...) 
	• Totalscoren må deretter deles på antall sub-policy områder, innenfor policy dimensjonen
	• Totalscore multipliseres med 100

Visualisering
	• Land per rad, sub-policyer i kolonne
	• Bare checkmarks om policy finnes
	• 1-100 rate
	• Eventuelt kart med implementeringsrate



C:/Users/JRMA/AppData/Local/Temp


## Data
Data import and packages utilised.

### Packages
```{r Packages}
options(tidyverse.quiet = TRUE)
library(tidyverse, eurostat)
```

### Data source

```{r Data}

policydb <- read_csv("C:\\Users\\JRMA\\OneDrive - Folkehelseinstituttet\\Dokumenter\\CO-CREATE\\policy-export10-Dec-2021.csv", show_col_types = FALSE)

colnames(policydb) <- c("DB_type", "PolicyArea", "SubPArea", "PolicyAction", "Country", "Topics")

head(policydb)

countries <- distinct(policydb, Country)
```

The `policies` data consists of `r nrow(policydb)` policy actions. 

#### Policy actions per country

These actions are located in `r nrow(countries)` different countries. The number of policies identified in each country is listed below:

<!-- sum of policies, grouped by country -->
```{r}
PA_countries <- policydb %>% count(Country, sort=TRUE, name = "Number of policy actions")

PA_countries
```


#### A hiearchical overview: Country -> Policy Area -> Sub- Policy area

```{r}


country_hierch <- policydb %>% count(Country, PolicyArea, SubPArea)

country_hierch
```



#### Policy hierarchy

```{r}
#filter(Country=="Norway") Lage en funksjon som tester alle land opp mot hverandre og hiearkiene? Hvor er man like etc?

PA_hierch <- policydb %>% count(PolicyArea, SubPArea, sort=TRUE, name = "Number of policy actions")

PA_hierch
```

#### Policy areas

```{r}
PA_dimensions <- policydb %>% count(PolicyArea, sort=TRUE, name = "Number of policy actions") %>% 
PA_dimensions
```

### Sub-policy areas

```{r}
PA_SPA <- policydb %>% count(PolicyArea, SubPArea, sort=TRUE, name = "Number of policy actions")

PA_SPA

```


## Methods

### if blank


<!-- if blank FALSE, else TRUE, på en unik liste -->

### Make empty index
```{r}
PAreas <- policydb %>% distinct(PolicyArea) #List of PAreas

vector_PAr <- c(t(PAreas)) #Make into character strings and list

GI_blank <- countries

GI_blank[ , c(vector_PAr)] <- NA

GI_blank

```

### Fill table with true or false



There will be four main steps outlined here.
1. Vectorisation and operationalisation of the framework for R compatibility. 
2. Loops and grouping of countries to check for policy implementation status
3. Create an implementation score for each policy area and country, followed by aggregation
4. Visualising the results using tables and maps.
5. Exploratory analyses 

### Vectorisation

lvl1 <- "NOURISHING"
lvl2 <- c("Food environment", "Food system", "Behaviour change communication")
lvl3 <- c("")